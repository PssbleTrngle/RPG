{% macro slot(stack, slot = null, character = null, renderEmpty = false) %}

	{% if stack %}
		<div class='slot' id='{{ stack.id }}'>
			<div>{{ stack.item|icon|raw }}</div>
			<p>{{ stack.amount }}x</p>
			<p>{{ stack.item.name() }}</p>
		</div>
	{% elseif renderEmpty %}
		<div class='slot-text'>
			{% if slot and character and slot.locked(character) %}
				<p>Locked</p>
			{% else %}
				<p>Empty</p>
			{% endif %}
		</div>
	{% endif %}

{% endmacro %}

{% import _self as inventory %}

<div data-reload='inventory'>

	<div class='popup' data-popup='.inventory-btn'>

		{% set slot = 'Slot'|byName('loot') %}
		{% if character.itemIn(slot).count > 0 %}
			<div class='inventory loot mb-2'>

				{% for stack in character.itemIn(slot) %}
					{{ inventory.slot(stack, slot, character) }}
				{% endfor %}

			</div>
		{% endif %}

		<div class='row h-4'></div>

		<div class='inventory mb-2'>

			<div class='slot-icon mirror'>{{ icon('slot/hand')|raw }}</div>

			{% for side in ['left', 'right'] %}

				{% set slot = 'Slot'|byName(side ~ '_hand') %}
				{{ inventory.slot(character.itemIn(slot), slot, character, true) }}
			{% endfor %}

			<div class='slot-icon'>{{ icon('slot/hand')|raw }}</div>

		</div>

		<div class='inventory'>

				{% set slot = 'Slot'|byName('inventory') %}
			{% for stack in character.itemIn(slot) %}
				{{ inventory.slot(stack, slot, character) }}
			{% endfor %}

		</div>
		 
	</div>

	{% for stack in character.inventory %}

		<div class='item-popup center mt-2' data-item='{{ stack.id }}'>

				<div class='options horizontal'>
					{% for slot in 'Slot'|all if slot.fits(stack, character).success %}
						<div class='option' data-slot='{{ slot.id }}'>{{ slot.name() }}</div>
					{% endfor %}
				</div>

				<h3>{{ stack.item.name() }}</h3>
				{% for key, type in stack.item.types() %}

					{% if key > 0 %}
						<p><small>{{ type.name() }}</small></p>
					{% else %}
						<p>{{ type.name() }}</p>
					{% endif %}

				{% endfor %}

		</div>

	{% endfor %}

</div>